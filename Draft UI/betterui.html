<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Check-In</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen relative">
  <div class="container mx-auto max-w-lg bg-white rounded-lg shadow-lg p-8">
    <h2 id="checkInTitle" class="text-3xl font-bold mb-6 text-center">Daily Check-In</h2>
    
    <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
      <div id="progressBar" class="bg-blue-600 h-2 rounded-full" style="width: 0%;"></div>
    </div>
    
    <form id="checkinForm" class="space-y-4" onkeydown="handleKeyNavigation(event)">
      <div id="section1" class="form-section">
        <h3 class="text-xl font-semibold mb-4">Yesterday's Top 3 Review - Task 1</h3>
        <input type="text" id="yesterdayTask1" placeholder="Task 1 title..." class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring">
        <label><input type="checkbox" id="yesterdayTask1Completed" checked onchange="toggleReason(1)"> Completed</label>
        <textarea id="yesterdayTask1Reason" placeholder="Reason for not completing..." class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring mt-2 hidden"></textarea>
        <button type="button" onclick="nextSection()" class="w-full mt-4 bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700">Next</button>
      </div>

      <div id="section13" class="form-section hidden">
        <h3 class="text-xl font-semibold mb-4">Gratitude</h3>
        <textarea id="gratitude" placeholder="List things you're grateful for..." class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring"></textarea>
        <button type="button" onclick="generateMarkdown()" class="w-full mt-4 bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700">Finish & Copy Markdown</button>
      </div>
    </form>
    
    <div id="copyNotification" class="fixed top-4 right-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded shadow-lg hidden">Copied to clipboard!</div>
  </div>

  <script>
    function setDayInTitle() {
      const options = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
      const today = new Date();
      document.getElementById("checkInTitle").textContent = `Daily Check-In - ${today.toLocaleDateString("en-US", options)}`;
    }
    setDayInTitle();

    let currentSection = 1;
    function nextSection() {
      document.getElementById(`section${currentSection}`).classList.add("hidden");
      currentSection++;
      document.getElementById(`section${currentSection}`).classList.remove("hidden");
      updateProgressBar();
    }

    function updateProgressBar() {
      const progress = (currentSection - 1) / 12 * 100;
      document.getElementById("progressBar").style.width = `${progress}%`;
    }

    function toggleReason(taskNumber) {
      const checkbox = document.getElementById(`yesterdayTask${taskNumber}Completed`);
      const reasonTextarea = document.getElementById(`yesterdayTask${taskNumber}Reason`);
      reasonTextarea.classList.toggle("hidden", checkbox.checked);
    }

    function handleKeyNavigation(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        nextSection();
      }
    }

    function generateMarkdown() {
      const dayOfWeek = document.getElementById("checkInTitle").textContent;

      let markdown = `${dayOfWeek}\n\n#### Yesterday's Top 3 Review\n`;

      for (let i = 1; i <= 3; i++) {
        const taskTitle = document.getElementById(`yesterdayTask${i}`).value.trim();
        const isCompleted = document.getElementById(`yesterdayTask${i}Completed`).checked;
        const reason = document.getElementById(`yesterdayTask${i}Reason`).value.trim();

        if (taskTitle) {
          markdown += `- **Task ${i}**: ${taskTitle}\n  - Completed: ${isCompleted ? "Yes" : "No"}`;
          if (!isCompleted && reason) {
            markdown += `\n  - Reason: ${reason}`;
          }
          markdown += "\n";
        }
      }

      markdown += `\n#### Top 3 for Tomorrow\n`;
      for (let i = 1; i <= 3; i++) {
        const tomorrowTaskTitle = document.getElementById(`tomorrowTask${i}`).value.trim();
        const tomorrowDescription = document.getElementById(`tomorrowTask${i}Description`).value.trim();
        if (tomorrowTaskTitle) {
          markdown += `- **Task ${i}**: ${tomorrowTaskTitle}`;
          if (tomorrowDescription) {
            markdown += `\n  - Description: ${tomorrowDescription}`;
          }
          markdown += "\n";
        }
      }
      navigator.clipboard.writeText(markdown).then(() => {
        showNotification();
      }).catch(console.error);
    }

    function showNotification() {
      const notification = document.getElementById("copyNotification");
      notification.classList.remove("hidden");
      setTimeout(() => notification.classList.add("hidden"), 2000);
    }
  </script>
</body>
</html>
